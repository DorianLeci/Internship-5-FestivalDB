CREATE TABLE country(
	country_id SERIAL PRIMARY KEY,
	name VARCHAR(40) NOT NULL
);

CREATE TABLE city(
	city_id SERIAL PRIMARY KEY,
	name VARCHAR(40) NOT NULL,
	postal_code VARCHAR(10),
	country_id INT NOT NULL REFERENCES country(country_id)
	
		
);

CREATE TABLE Visitor(
	visitor_id SERIAL PRIMARY KEY,
	name VARCHAR(30) NOT NULL,
	surname VARCHAR(30) NOT NULL,
	email VARCHAR(50),
	birthDate DATE,
	city_id INT NOT NULL REFERENCES city(city_id)
);

CREATE TYPE festival_status AS ENUM('Planiran','Aktivan','Zavrsen');

CREATE TABLE festival(
	festival_id SERIAL PRIMARY KEY,
	name VARCHAR(30) NOT NULL,
	capacity INT NOT NULL,
	start_date DATE NOT NULL,
	end_date DATE NOT NULL,
	has_visitor_camp BOOL,
	status festival_status NOT NULL,
	city_id INT NOT NULL REFERENCES city(city_id)	
);



CREATE TYPE music_genre AS ENUM(
 'Rock','Pop','Jazz','House','HipHop','Classical','Blues','Country','Metal','Soul','Reggae','Funk','Techno','Disco');
 
CREATE TABLE performer(
	performer_id SERIAL PRIMARY KEY,
	name VARCHAR(30) NOT NULL,
	genre music_genre,
	is_active BOOL,
	country_id INT NOT NULL REFERENCES country(country_id)
);

CREATE TABLE solo_peformer(
	solo_performer_id SERIAL PRIMARY KEY,
	performer_iD INT UNIQUE REFERENCES performer(performer_id)
);

CREATE TABLE dj(
	dj_id SERIAL PRIMARY KEY,
	performer_id INT UNIQUE REFERENCES performer(performer_id)
);

CREATE TABLE band(
	band_id SERIAL PRIMARY KEY,
	band_name VARCHAR(40) NOT NULL
);

CREATE TABLE band_member(
	band_member_id SERIAL PRIMARY KEY,
	performer_iD INT UNIQUE REFERENCES performer(performer_id),
	band_id INT NOT NULL REFERENCES band(band_id)
);

CREATE EXTENSION IF NOT EXISTS btree_gist;

CREATE TABLE festival_performer(
	performer_id INT NOT NULL REFERENCES performer(performer_id),
	festival_id INT NOT NULL REFERENCES festival(festival_id),
	festival_date_period DATERANGE,
	PRIMARY KEY(performer_id,Festival_id),

	EXCLUDE USING gist(
		performer_id WITH =,
		festival_date_period WITH &&
	)
);

ALTER TABLE bAND
ADD COLUMN number_of_members INT 


CREATE TYPE festival_location AS ENUM ('Main','Forest','Beach');

CREATE TABLE stage(
	stage_id SERIAL PRIMARY KEY,
	name VARCHAR(20),
	capacity INT,
	is_covered BOOL,
	location festival_location,
	festival_id INT NOT NULL REFERENCES festival(festival_id) ON DELETE CASCADE
	
	
);
CREATE TABLE performance(

	performance_id SERIAL PRIMARY KEY,
	performer_id INT NOT NULL,
	festival_id INT NOT NULL,
	start_time TIMESTAMP NOT NULL,
	end_time TIMESTAMP NOT NULL,
	stage_id INT NOT NULL REFERENCES stage(stage_idd),
	
	FOREIGN KEY(performer_id,festival_id) REFERENCES festival_performer(performer_id,festival_id)
);

ALTER TABLE Performance 









